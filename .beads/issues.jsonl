{"id":"tr-52u","title":"We only do multilangauge translation now so we can get rid of the single-language stuff (prompts, functions, etc) and rename what's left to get rid of the 'multi*' prefixes","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T15:30:05.018283+01:00","updated_at":"2026-01-18T15:35:27.892558+01:00","closed_at":"2026-01-18T15:35:27.892558+01:00","close_reason":"Closed","comments":[{"id":3,"issue_id":"tr-52u","author":"Herb Caudill","text":"## Summary of Changes\n\nRemoved unused single-language translation code and simplified the API by renaming the multi-language functions:\n\n### Files Changed:\n- **src/lib/prompts.ts**: Removed `SYSTEM_PROMPT` (single-language), renamed `MULTI_LANGUAGE_SYSTEM_PROMPT` to `SYSTEM_PROMPT`\n- **src/lib/anthropic.ts**: Removed `translate()` function, `TranslationResult` type, and related code; renamed `translateAll()` to `translate()`, `MultiTranslationResult` to `TranslationResult`\n- **src/lib/anthropic.test.ts**: Removed single-language translation tests (11 tests), updated remaining tests to use `translate()`\n- **src/hooks/useTranslation.ts**: Updated import from `translateAll` to `translate`\n- **src/hooks/useTranslation.test.ts**: Updated mock and references from `translateAll` to `translate`\n- **src/App.test.tsx**: Updated mock and references from `translateAll` to `translate`\n- **CLAUDE.md**: Updated documentation to reference `translate()` instead of `translateAll()`\n\n### Net Result:\n- Removed ~315 lines of code\n- Reduced test count from 199 to 188 (removed 11 single-language tests)\n- Cleaner, simpler API with `translate()` for multi-language translation","created_at":"2026-01-18T14:35:23Z"}]}
{"id":"tr-93x","title":"Test failures: TranslationResult and TranslationOutput components","description":"## Summary\n7 tests are failing in 3 test files related to translation output components.\n\n## Failing Tests\n\n### 1. `src/components/TranslationResult.test.tsx`\n- **TranslationResult \u003e renders the saved translation icon** - Unable to find element with accessible name \"Translation saved\"\n\n### 2. `src/components/TranslationOutput.test.tsx` (5 failures)\n- **TranslationOutput \u003e displays translations when provided** - Expected \"hola\" text to be present but it wasn't found\n- **TranslationOutput \u003e shows audio button for translations** - Unable to find element with accessible name matching /Play audio for/\n- **TranslationOutput \u003e shows no audio button when audio playback is disabled** - Unable to find element with accessible name matching /Play audio for/\n- **TranslationOutput \u003e does not show translate button when aiPromptRunner is null** - Unable to find element with role \"tab\"\n- **TranslationOutput \u003e shows the audio button for a specific phrase** - Unable to find element with accessible name matching /Play audio for/\n\n### 3. `src/App.test.tsx`\n- **App \u003e shows saved indicator when translation is saved** - Expected \"Save translation\" text to be present but found \"Unsave translation\" instead\n\n## Root Cause Analysis\nThe test failures suggest a mismatch between the expected component structure/text in tests vs actual implementation:\n1. Translation saved/unsaved icon accessibility labels may have changed\n2. TranslationOutput component structure may have changed - tests expect certain elements that are not present\n3. Audio button accessibility names may have changed\n\n## Recommended Fix\nReview and update the failing tests to match the current component implementations, or fix the components if the current behavior is unintended.","status":"tombstone","priority":1,"issue_type":"bug","owner":"herb@devresults.com","created_at":"2026-01-18T14:55:30.765442+01:00","created_by":"Herb Caudill","updated_at":"2026-01-18T15:02:20.895342+01:00","deleted_at":"2026-01-18T15:02:20.895342+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"bug"}
{"id":"tr-9cw","title":"Test failures in TranslationResults.test.tsx","description":"## Summary\nThere are 7 failing tests in the test suite related to `TranslationResults.test.tsx`.\n\n## Root Cause\nThe tests expect the source language tab (e.g., \"English\") to be rendered and disabled in the tab list, but the component currently filters out the source language entirely from the displayed tabs:\n\n```tsx\n// TranslationResults.tsx line 31\nconst selectableLanguages = languages.filter(l =\u003e l.code !== sourceLanguage)\n```\n\n## Failing Tests\n1. **renders all language tabs including source language** - Expects English tab to exist, but it's filtered out\n2. **disables source language tab** - Expects English tab to be disabled, but it doesn't exist  \n3. **shows selected tab content** - Fails because tab state assertions don't work as expected\n4. **calls onTabChange when clicking different tab** - Fails due to tab structure mismatch\n5. **applies mono font to translation text** - Fails because text isn't found\n6. **uses flex layout to fill available vertical space for swipe target** - Fails due to DOM structure mismatch\n7. **renders three skeleton option placeholders when loading** - Expects 6 skeletons but component renders differently\n\n## Decision Needed\nEither:\n1. **Update the tests** to match the current component behavior (source language tab is not shown)\n2. **Update the component** to show the source language tab but keep it disabled (as the tests expect)\n\n## Test Output\n```\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e renders all language tabs including source language\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e disables source language tab\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e shows selected tab content\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e calls onTabChange when clicking different tab\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e applies mono font to translation text\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e uses flex layout to fill available vertical space for swipe target\n✗ src/components/TranslationResults.test.tsx \u003e TranslationResults \u003e renders three skeleton option placeholders when loading\n```","status":"closed","priority":1,"issue_type":"task","owner":"herb@devresults.com","created_at":"2026-01-18T15:12:27.358386+01:00","created_by":"Herb Caudill","updated_at":"2026-01-18T15:14:46.827345+01:00","closed_at":"2026-01-18T15:14:46.827345+01:00","close_reason":"Closed","comments":[{"id":1,"issue_id":"tr-9cw","author":"Herb Caudill","text":"## Summary\n\nFixed 7 failing tests across 3 components:\n\n### TranslationResults.tsx\n- Changed from filtering out the source language tab to showing it as a disabled tab\n- Tests expected the source language to be visible but not clickable\n\n### SettingsDialog.tsx  \n- Updated dialog title from \"Languages\" to \"Settings\"\n- Added DialogDescription: \"Configure your translation preferences.\"\n- Added \"Target languages\" heading for the language list section\n\n### TranslateInput.tsx\n- Fixed race condition in `handleFocus` where `requestAnimationFrame(() =\u003e input.select())` would interfere with typing\n- Added check to only select text if the input value hasn't changed since focus began\n- This was causing tests to receive partial text (e.g., \"llo\" instead of \"hello\")\n\nAll 199 tests now pass.","created_at":"2026-01-18T14:14:42Z"}]}
{"id":"tr-ad2","title":"make the source language text smaller","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T15:31:45.228466+01:00","updated_at":"2026-01-18T15:45:41.984017+01:00","closed_at":"2026-01-18T15:45:41.984017+01:00","close_reason":"Closed","comments":[{"id":4,"issue_id":"tr-ad2","author":"Herb Caudill","text":"Changed the 'Translated from X' banner text from `text-sm` to `text-xs` in `TranslationResults.tsx` to make it more subtle and less visually prominent.","created_at":"2026-01-18T14:45:38Z"}]}
{"id":"tr-phk","title":"the source language header should fill the full width of the screen","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T15:33:21.97033+01:00","updated_at":"2026-01-18T15:51:11.396176+01:00","closed_at":"2026-01-18T15:51:11.396176+01:00","close_reason":"Closed","comments":[{"id":5,"issue_id":"tr-phk","author":"Herb Caudill","text":"## Changes Made\n\nRestructured the layout to make the \"Translated from\" source language banner span the full screen width:\n\n- Moved `TranslationResults` component out of the constrained `max-w-2xl` container in `App.tsx`\n- Updated `TranslationResults.tsx` to:\n  - Make the source language banner a full-width element with its own internal max-width constraint for content alignment\n  - Added a new inner container for the tabs and translation content that maintains the `max-w-2xl` constraint\n\nThe banner now extends edge-to-edge while the content below (tabs, translations) remains centered and constrained to the same max width as the header.","created_at":"2026-01-18T14:51:07Z"}]}
{"id":"tr-rrf","title":"add same padding to source language div that is used in the rest of the app","status":"in_progress","priority":2,"issue_type":"task","created_at":"2026-01-18T16:22:32.159918+01:00","updated_at":"2026-01-18T16:23:14.113557+01:00"}
{"id":"tr-t6t","title":"store the prompt in markdown for legibility","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T15:35:28.528963+01:00","updated_at":"2026-01-18T16:05:27.541438+01:00","closed_at":"2026-01-18T16:05:27.541438+01:00","close_reason":"Closed","comments":[{"id":6,"issue_id":"tr-t6t","author":"Herb Caudill","text":"## Summary\n\nMoved the system prompt from an inline template string in `prompts.ts` to a separate Markdown file (`system-prompt.md`) for better legibility.\n\n### Changes\n- Created `src/lib/system-prompt.md` containing the prompt content\n- Updated `src/lib/prompts.ts` to import the markdown file using Vite's `?raw` suffix\n- The `SYSTEM_PROMPT` export remains unchanged for consumers\n\n### Benefits\n- Better syntax highlighting when editing the prompt\n- Easier to read and maintain\n- Markdown format makes the JSON example more readable","created_at":"2026-01-18T15:05:23Z"}]}
{"id":"tr-t86","title":"Test failures in TranslationPanel, TranslateInput, and App tests","description":"## Test Failures Summary\n\nThere are 7 failing tests across 3 test files:\n\n### 1. src/components/TranslationPanel.test.tsx (3 failures)\n\n**Test: \"shows definition and pronunciation when translation is selected and showDetails is true\"**\n- Expected: `/hello/` (phonetic pronunciation)\n- Received: Element not found\n- The test expects a pronunciation element to be visible when showDetails is true, but it's not rendered\n\n**Test: \"clicking a translation should update the value in the input\"** \n- Expected: Input value to be \"hola\" after clicking translation\n- Received: Input value is still \"hello\"\n- The click handler is not properly updating the input value\n\n**Test: \"clicking search button for selected translation calls onSearch\"**\n- Expected: onSearch to be called once\n- Received: Not called\n- The search button click handler is not working\n\n### 2. src/components/TranslateInput.test.tsx (2 failures)\n\n**Test: \"shows clear button when value is non-empty and not loading\"**\n- Expected: Clear button to be visible\n- Received: Button not found with name \"Clear input\"\n- The clear button is not being rendered when it should be\n\n**Test: \"calls onClear when clear button is clicked\"**\n- Expected: onClear to be called when clear button is clicked  \n- Received: Button not found\n- Same issue - clear button not rendered\n\n### 3. src/App.test.tsx (2 failures)\n\n**Test: \"displays translation results for all languages\"**\n- Expected: \"hola\" to be visible in results\n- Received: Only language tabs shown, no translation content\n- The translation results are not being rendered properly\n\n**Test: \"maintains previous translations while loading new ones\"**\n- Expected: \"hola\" to be visible during loading\n- Received: Only shows tabs, no content\n- Same rendering issue with translation results\n\n## Root Causes to Investigate\n\n1. TranslateInput clear button rendering logic\n2. TranslationPanel click handlers and showDetails conditional rendering\n3. App component translation results display","status":"tombstone","priority":1,"issue_type":"task","owner":"herb@devresults.com","created_at":"2026-01-18T14:49:06.662215+01:00","created_by":"Herb Caudill","updated_at":"2026-01-18T15:11:39.429378+01:00","deleted_at":"2026-01-18T15:11:39.429378+01:00","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"tr-vyo","title":"The 'Translated from...' div should have no rounding or margin-top, so it should abut the dark blue header. and it should extend across the screen's width. and the text should be black except for the button which should be gray. the name of the language should be bold, not italic","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T14:50:46.340723+01:00","updated_at":"2026-01-18T15:27:29.169936+01:00","closed_at":"2026-01-18T15:27:29.169936+01:00","close_reason":"Closed","comments":[{"id":2,"issue_id":"tr-vyo","author":"Herb Caudill","text":"## Summary\n\nUpdated the 'Translated from' banner styling in `TranslationResults.tsx`:\n\n- **Full width**: Added negative margins (`-mx-4 sm:-mx-6`) to break out of the parent container and extend full width\n- **No rounding**: Removed `rounded-md` class\n- **Abuts header**: Added `-mt-4 sm:-mt-6` to remove top margin and make it flush with the header\n- **Text colors**: Changed main text from `text-blue-700` to `text-black`, and button from `text-blue-600` to `text-gray-500`\n- **Language name**: Changed from `font-medium italic` to `font-bold` (bold, not italic)\n\nAll tests pass.","created_at":"2026-01-18T14:27:25Z"}]}
